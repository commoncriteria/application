<?xml version="1.0" encoding="utf-8"?>
<technical-decisions  xmlns:h="http://www.w3.org/1999/xhtml" 
		      xmlns="https://niap-ccevs.org/cc/v1">
  <bunch>
    <applies-to max-inclusive="1.3" name="Protection Profile for Application Software"/>

    <decision id='0444'>
    	<notes>IPsec selections</notes>

        <change xpath=".//f-element[@id='ftp_dit_ext.1.1']" mode="replace">
          <f-element id="ftp_dit_ext.1.1">
            <title>The application shall 
	    <selectables linebreak="yes">
        <selectable>not transmit any 
          <selectables>
            <selectable>data</selectable>
            <selectable>sensitive data</selectable>
          </selectables>
        </selectable>
      <selectable>encrypt all transmitted 
		    <selectables>
			     <selectable>sensitive data</selectable>
			     <selectable>data</selectable>
	      </selectables> with
          <selectables>
            <selectable id="sel_all_https"><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr> in accordance with FCS_HTTPS_EXT.1</selectable>
      	    <selectable id="sel_all_tlsc"><h:abbr title="Transport Layer Security">TLS</h:abbr> as defined in the <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=426&amp;id=426"><h:i>TLS Package</h:i></h:a></selectable>
      	    <selectable id="sel_all_dtls"><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr> as defined in the <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=426&amp;id=426"><h:i>TLS Package</h:i></h:a></selectable>
            <selectable>SSH as conforming to the Extended Package for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=389&amp;id=389"><h:i>Secure Shell</h:i></h:a></selectable>
            <selectable>IPsec as defined in the PP-Module for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=419&amp;id=419"><h:i>VPN Client</h:i></h:a></selectable>
          </selectables>
        </selectable>
 
	 <selectable>invoke platform-provided functionality to encrypt all transmitted sensitive data with
      <selectables>
        <selectable><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr></selectable>
        <selectable><h:abbr title="Transport Layer Security">TLS</h:abbr></selectable>
        <selectable><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr></selectable>
        <selectable>SSH</selectable>
      </selectables>
    </selectable>	    
	      
    <selectable>invoke platform-provided functionality to encrypt all transmitted data with
      <selectables>
        <selectable><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr></selectable>
        <selectable><h:abbr title="Transport Layer Security">TLS</h:abbr></selectable>
        <selectable><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr></selectable>
        <selectable>SSH</selectable>
      </selectables>
    </selectable>	    
		    
	    </selectables>
              between itself and another trusted IT product.
	    </title>
      <note role="application">
	      <!--The X509 requirements are invoked based on the selections in FTP_DIT_EXT.1; if you select a protocol that uses certificates,
	      then you must include the SFRs that address the certificates.   
	      X509 SFRs shall be included if selections for HTTPS, TLS, or DTLS are included (FCS_HTTPS, FCS_TLSC, FCS_TLSS, FCS_DTLS).
	       <h:br/> <h:br/>-->
	      Encryption is not required for applications transmitting data that is not sensitive. 
		  <h:br/>
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>TLS</h:i> is selected, then evaluation of elements from either <linkref linkend="FCS_TLSC_EXT.1"/> or <linkref linkend="FCS_TLSS_EXT.1"/> is required.</h:p>
	      <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>HTTPS</h:i> is selected, <linkref linkend="FCS_HTTPS_EXT.1"/> is required.</h:p> 
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>DTLS</h:i> is selected, <linkref linkend="FCS_DTLS_EXT.1"/> is required.</h:p>
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>SSH</h:i> is selected, the TSF shall be validated against the <h:i>Extended Package for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=389&amp;id=389">Secure Shell</h:a></h:i>.</h:p>
<h:p>
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>IPsec</h:i> is selected, the TSF must claim conformance to a PP-Configuration that includes the <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=419&amp;id=419">VPN Client PP-Module</h:a></h:i>.</h:p>
<h:p>
		    If <h:i>encrypt all transmitted</h:i> is selected the corresponding FCS_COP.1 requirements will be included.
		  </h:p>
	    </note>  
      <aactivity>
        <TSS/>For platform-provided functionality, the evaluator shall verify the TSS contains the calls to the platform that TOE is leveraging to invoke the functionality.
        <Guidance/>None.
        <Tests/>The evaluator shall perform the following tests.
        <testlist>
          <test>
            The evaluator shall exercise the application (attempting to transmit data; for example 
            by connecting to remote systems or websites) while capturing packets from the 
            application. The evaluator shall verify from the packet capture that the traffic is 
            encrypted with <h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr>, 
            <h:abbr title="Transport Layer Security">TLS</h:abbr>, 
            <h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr>, <h:abbr title="Secure Shell">SSH</h:abbr>, or <h:abbr title="Internet Protocol Security">IPsec</h:abbr> in accordance with the 
            selection in the <abbr title="Security Target" linkend="ST">ST</abbr>.
          </test>
          <test>
            The evaluator shall exercise the application (attempting to transmit data; for example by 
    	      connecting to remote systems or websites) while capturing packets from the application.
    	      The evaluator shall review the packet capture and verify that no sensitive data is transmitted 
    	      in the clear.
	        </test>
          <test>
            The evaluator shall inspect the TSS to determine if user credentials are
            transmitted. If credentials are transmitted the evaluator shall set the
            credential to a known value. The evaluator shall capture packets from the application
            while causing credentials to be transmitted as described in the TSS.
            The evaluator shall perform a string search
            of the captured network packets and verify that the plaintext credential previously
            set by the evaluator is not found.
          </test>
        </testlist>
        <subaactivity platform="android">
          If "not transmit any data" is selected, the evaluator shall ensure that the application's
          AndroidManifest.xml file does not contain a uses-permission or uses-permission-sdk-23 tag
          containing android:name="android.permission.INTERNET".
          In this case,
          it is not necessary to perform the above Tests 1, 2, or 3, as the platform will not allow the
          application to perform any network communication.
          <!-- TODO: The current wording here adds additional work when "encrypt all transmitted data"
               is selected. It'd be preferable if we can instead simplify evaluation in that case, to encourage
               app developers to select it, so this is commented out for now.
               If "encrypt all transmitted data" is selected, the evaluator
               shall ensure that the application's manifest declares usesCleartextTraffic="false". It is
               still necessary to perform the above tests, as this manifest entry is only enforced on
               a best effort basis by the platform. -->
        </subaactivity>
        <subaactivity platform="ios">
          If "encrypt all transmitted data" is selected, the evaluator shall ensure that the
          application's Info.plist file does not contain the NSAllowsArbitraryLoads or
          NSExceptionAllowsInsecureHTTPLoads keys, as these keys disable iOS's Application
          Transport Security feature.
          <!-- TODO: Check the strength of iOS's App Transport Security enforcement (if apps
               can't easily bypass it, then we can skip performing Tests 1, 2, 3 on iOS when
               App Transport Security isn't explicitly disabled (assuming use of iOS 9 or greater)). -->
        </subaactivity>
      </aactivity>
          </f-element>
	</change>

        <change xpath=".//f-element[@id='fia_x509_ext.2.1']" mode="replace">
          <f-element id="fia_x509_ext.2.1">
            <title>
              The application shall use X.509v3 certificates as defined by RFC 5280 to support 
              authentication for 
              <selectables>
                 <selectable>
                  HTTPS
                </selectable>
                <selectable>
                  TLS
                </selectable>
                <selectable>
                  DTLS
                </selectable>
                <selectable>
                  SSH
                </selectable>
                <selectable>
                  IPsec
                </selectable>
              </selectables>. 
            </title>
            <note role="application">
              The <abbr title="Security Target" linkend="ST">ST</abbr> author's selection shall match the selection in 
              <linkref linkend="FTP_DIT_EXT.1.1"/>.
            </note>
            <!-- 
            <aactivity>
              Currently no EAs available.
            </aactivity>
            -->
          </f-element>
	</change>

    </decision>
  </bunch>
</technical-decisions>
