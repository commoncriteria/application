<?xml version="1.0" encoding="utf-8"?>
<technical-decisions  xmlns:h="http://www.w3.org/1999/xhtml" 
		      xmlns="https://niap-ccevs.org/cc/v1">
  <bunch>
    <applies-to max-inclusive="1.3" name="Protection Profile for Application Software"/>

    <decision id='0473'>
    	<notes>Support for Client or Server TOEs in FCS_HTTPS_EXT</notes>

        <change xpath=".//f-element[@id='fcs_https_ext.1.1']" mode="replace">
          <f-element id="fcs_https_ext.1.1">
            <title>This SFR was replaced with /Client and /Server versions according to NIAP Technical Decision 473.
            </title>
          </f-element>
	</change>

        <change xpath=".//f-element[@id='fcs_https_ext.1.2']" mode="replace">
          <f-element id="fcs_https_ext.1.2">
            <title>This SFR was replaced with /Client and /Server versions according to NIAP Technical Decision 473.
            </title>
          </f-element>
	</change>

        <change xpath=".//f-element[@id='fcs_https_ext.1.3']" mode="replace">
          <f-element id="fcs_https_ext.1.3">
            <title>This SFR was replaced with /Client and /Server versions according to NIAP Technical Decision 473. 
            </title>    
          </f-element>
	</change>

        <change xpath=".//f-component[@id='fcs_https_ext.1/Client']" mode="add">
        <f-component id="fcs_https_ext.1" name="HTTPS Protocol" status="sel-based">
          <selection-depends req="ftp_dit_ext.1.1" ids="sel_all_https,sel_sen_https"/>
          <f-element id="fcs_https_ext.1.1/Client">
            <title>
              The application shall implement the HTTPS protocol that complies with RFC 2818.
            </title>
            <aactivity>
              <TSS/>The evaluator shall examine the TSS and determine that enough detail is provided to explain how the implementation complies with RFC 2818.
              <Guidance/>None.
              <Tests/>The evaluator shall attempt to establish an HTTPS connection with a webserver, 
              observe the traffic with a packet analyzer, and verify that the connection succeeds 
              and that the traffic is identified as 
              <h:abbr title="Transport Layer Security">TLS</h:abbr> or HTTPS.
            </aactivity>
          </f-element>
          <f-element id="fcs_https_ext.1.2/Client">
            <title>The application shall implement HTTPS using 
              <h:abbr title="Transport Layer Security">TLS</h:abbr> as defined in the TLS package.
            </title>
            <aactivity>
              <TSS/>None.
              <Guidance/>None.
              <Tests/>Other tests are performed in conjunction with the TLS package.
            </aactivity>
          </f-element>
          <f-element id="fcs_https_ext.1.3/Client">
            <title> The application shall 
              <selectables>
                <selectable>
                  not establish the application-initiated connection
                </selectable>
                <selectable>
                  notify the user and not establish the user-initiated connection
                </selectable>
                <selectable>
                  notify the user and request authorization to establish the user-initiated connection
                </selectable>
              </selectables>
              if the peer certificate is deemed invalid.
            </title>    
            <note role="application">
              Validity is determined by the certificate path, the expiration date, and the 
              revocation status in accordance with RFC 5280. 
            </note>
            <aactivity>
              <TSS/>None.
              <Guidance/>None.
              <Tests/>Certificate validity shall be tested in accordance with testing performed for 
              <linkref linkend="FIA_X509_EXT.1"/>, and the evaluator shall perform the following test:
              <testlist>
                <test>
                  The evaluator shall demonstrate that using a certificate without a valid 
                  certification path results in the selected action in the SFR. If "notify the user" is selected 
                  in the SFR, then the evaluator shall also determine that the user is notified of the certificate validation 
                  failure. Using the administrative guidance, the evaluator shall then load a certificate or 
                  certificates to the Trust Anchor Database needed to validate the certificate to be 
                  used in the function, and demonstrate that the function succeeds. The evaluator 
                  then shall delete one of the certificates, and show that again, using a certificate without a valid 
                  certification path results in the selected action in the SFR, and if "notify the user" was selected 
                  in the SFR, the user is notified of the validation failure.
                </test>
              </testlist>
            </aactivity>
          </f-element>
        </f-component>
	</change>

        <change xpath=".//f-component[@id='fcs_https_ext.1/Server']" mode="add">
        <f-component id="fcs_https_ext.1" name="HTTPS Protocol" status="sel-based">
          <selection-depends req="ftp_dit_ext.1.1" ids="sel_all_https,sel_sen_https"/>
          <f-element id="fcs_https_ext.1.1/Server">
            <title>
              The application shall implement the HTTPS protocol that complies with RFC 2818.
            </title>
            <aactivity>
              <TSS/>The evaluator shall examine the TSS and determine that enough detail is provided to explain how the implementation complies with RFC 2818.
              <Guidance/>None.
              <Tests/>The evaluator shall attempt to establish an HTTPS connection to the TOE using a client, observe the traffic with a packet analyzer, and verify that the connection succeeds and that the traffic is identified as 
              <h:abbr title="Transport Layer Security">TLS</h:abbr> or HTTPS.
            </aactivity>
          </f-element>
          <f-element id="fcs_https_ext.1.2/Server">
            <title>The application shall implement HTTPS using 
              <h:abbr title="Transport Layer Security">TLS</h:abbr> as defined in the TLS package.
            </title>
            <aactivity>
              <TSS/>None.
              <Guidance/>None.
              <Tests/>Other tests are performed in conjunction with the TLS package.
            </aactivity>
          </f-element>
        </f-component>
	</change>

        <change xpath=".//f-component[@id='fcs_https_ext.2']" mode="add">
        <f-component id="fcs_https_ext.2" name="HTTPS Protocol with Mutual Authentication" status="sel-based">
          <selection-depends req="ftp_dit_ext.1.1" ids="sel_all_https,sel_sen_https"/>
          <f-element id="fcs_https_ext.2.1">
            <title> The application shall 
              <selectables>
                <selectable>
                  not establish the connection
                </selectable>
                <selectable>
                  establish or not establish the connection based on an administrative or user setting
                </selectable>
              </selectables>
              if the peer certificate is deemed invalid.
            </title>    
            <note role="application">
              Validity is determined by the certificate path, the expiration date, and the 
              revocation status in accordance with RFC 5280. 
            </note>
            <aactivity>
              <TSS/>None.
              <Guidance/>None.
              <Tests/>Certificate validity shall be tested in accordance with testing performed for 
              <linkref linkend="FIA_X509_EXT.1"/>, and the evaluator shall perform the following test:
              <testlist>
                <test>
                  The evaluator shall demonstrate that using a certificate without a valid 
                  certification path results in the selected action in the SFR. Using the administrative guidance, the evaluator shall then load a certificate or certificates to the Trust Anchor Database needed to validate the certificate to be used in the function, and demonstrate that the function succeeds. The evaluator then shall delete one of the certificates, and show that again, using a certificate without a valid certification path results in the selected action in the SFR.
                </test>
              </testlist>
            </aactivity>
          </f-element>
        </f-component>
	</change>

        <change xpath=".//f-element[@id='ftp_dit_ext.1.1']" mode="replace">
          <f-element id="ftp_dit_ext.1.1">
            <title>The application shall 
	    <selectables linebreak="yes">
        <selectable>not transmit any 
          <selectables>
            <selectable>data</selectable>
            <selectable>sensitive data</selectable>
          </selectables>
        </selectable>
      <selectable>encrypt all transmitted 
		    <selectables>
			     <selectable>sensitive data</selectable>
			     <selectable>data</selectable>
	      </selectables> with
          <selectables>
            <selectable id="sel_all_https"><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr> in accordance with FCS_HTTPS_EXT.1</selectable>
      	    <selectable id="sel_all_tlsc"><h:abbr title="Transport Layer Security">TLS</h:abbr> as defined in the <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=426&amp;id=426"><h:i>TLS Package</h:i></h:a></selectable>
      	    <selectable id="sel_all_dtls"><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr> as defined in the <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=426&amp;id=426"><h:i>TLS Package</h:i></h:a></selectable>
            <selectable>SSH as conforming to the Extended Package for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=389&amp;id=389"><h:i>Secure Shell</h:i></h:a></selectable>
            <selectable>IPsec as defined in the PP-Module for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=419&amp;id=419"><h:i>VPN Client</h:i></h:a></selectable>
          </selectables>
        </selectable>
 
	 <selectable>invoke platform-provided functionality to encrypt all transmitted sensitive data with
      <selectables>
        <selectable><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr></selectable>
        <selectable><h:abbr title="Transport Layer Security">TLS</h:abbr></selectable>
        <selectable><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr></selectable>
        <selectable>SSH</selectable>
      </selectables>
    </selectable>	    
	      
    <selectable>invoke platform-provided functionality to encrypt all transmitted data with
      <selectables>
        <selectable><h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr></selectable>
        <selectable><h:abbr title="Transport Layer Security">TLS</h:abbr></selectable>
        <selectable><h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr></selectable>
        <selectable>SSH</selectable>
      </selectables>
    </selectable>	    
		    
	    </selectables>
              between itself and another trusted IT product.
	    </title>
      <note role="application">
	      <!--The X509 requirements are invoked based on the selections in FTP_DIT_EXT.1; if you select a protocol that uses certificates,
	      then you must include the SFRs that address the certificates.   
	      X509 SFRs shall be included if selections for HTTPS, TLS, or DTLS are included (FCS_HTTPS, FCS_TLSC, FCS_TLSS, FCS_DTLS).
	       <h:br/> <h:br/>-->
	      Encryption is not required for applications transmitting data that is not sensitive. 
		  <h:br/>
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>TLS</h:i> is selected, then evaluation of elements from either <linkref linkend="FCS_TLSC_EXT.1"/> or <linkref linkend="FCS_TLSS_EXT.1"/> is required.</h:p>
	      <h:p> If <h:i>encrypt all transmitted</h:i> is selected, <h:i>HTTPS</h:i> is selected, and the TOE acts as a client, <linkref linkend="FCS_HTTPS_EXT.1/Client"/> is required. If <h:i>encrypt all transmitted</h:i> is selected, <h:i>HTTPS</h:i> is selected, and the TOE acts as a server, <linkref linkend="FCS_HTTPS_EXT.1/Server"/> is required.
If the TOE acts as a server and if mutual authentication is selected in the TLS Package, then FCS_HTTPS_EXT.2 is also required.
</h:p> 
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>DTLS</h:i> is selected, <linkref linkend="FCS_DTLS_EXT.1"/> is required.</h:p>
        <h:p> If <h:i>encrypt all transmitted</h:i> is selected and <h:i>SSH</h:i> is selected, the TSF shall be validated against the <h:i>Extended Package for <h:a href="https://www.niap-ccevs.org/Profile/Info.cfm?PPID=389&amp;id=389">Secure Shell</h:a></h:i>.</h:p>
<h:p>
		    If <h:i>encrypt all transmitted</h:i> is selected the corresponding FCS_COP.1 requirements will be included.
		  </h:p>
	    </note>  
      <aactivity>
        <TSS/>For platform-provided functionality, the evaluator shall verify the TSS contains the calls to the platform that TOE is leveraging to invoke the functionality.
        <Guidance/>None.
        <Tests/>The evaluator shall perform the following tests.
        <testlist>
          <test>
            The evaluator shall exercise the application (attempting to transmit data; for example 
            by connecting to remote systems or websites) while capturing packets from the 
            application. The evaluator shall verify from the packet capture that the traffic is 
            encrypted with <h:abbr title="Hypertext Transfer Protocol Secure">HTTPS</h:abbr>, 
            <h:abbr title="Transport Layer Security">TLS</h:abbr>, 
            <h:abbr title="Datagram Transport Layer Security">DTLS</h:abbr>, or <h:abbr title="Secure Shell">SSH</h:abbr> in accordance with the 
            selection in the <abbr title="Security Target" linkend="ST">ST</abbr>.
          </test>
          <test>
            The evaluator shall exercise the application (attempting to transmit data; for example by 
    	      connecting to remote systems or websites) while capturing packets from the application.
    	      The evaluator shall review the packet capture and verify that no sensitive data is transmitted 
    	      in the clear.
	        </test>
          <test>
            The evaluator shall inspect the TSS to determine if user credentials are
            transmitted. If credentials are transmitted the evaluator shall set the
            credential to a known value. The evaluator shall capture packets from the application
            while causing credentials to be transmitted as described in the TSS.
            The evaluator shall perform a string search
            of the captured network packets and verify that the plaintext credential previously
            set by the evaluator is not found.
          </test>
        </testlist>
        <subaactivity platform="android">
          If "not transmit any data" is selected, the evaluator shall ensure that the application's
          AndroidManifest.xml file does not contain a uses-permission or uses-permission-sdk-23 tag
          containing android:name="android.permission.INTERNET".
          In this case,
          it is not necessary to perform the above Tests 1, 2, or 3, as the platform will not allow the
          application to perform any network communication.
          <!-- TODO: The current wording here adds additional work when "encrypt all transmitted data"
               is selected. It'd be preferable if we can instead simplify evaluation in that case, to encourage
               app developers to select it, so this is commented out for now.
               If "encrypt all transmitted data" is selected, the evaluator
               shall ensure that the application's manifest declares usesCleartextTraffic="false". It is
               still necessary to perform the above tests, as this manifest entry is only enforced on
               a best effort basis by the platform. -->
        </subaactivity>
        <subaactivity platform="ios">
          If "encrypt all transmitted data" is selected, the evaluator shall ensure that the
          application's Info.plist file does not contain the NSAllowsArbitraryLoads or
          NSExceptionAllowsInsecureHTTPLoads keys, as these keys disable iOS's Application
          Transport Security feature.
          <!-- TODO: Check the strength of iOS's App Transport Security enforcement (if apps
               can't easily bypass it, then we can skip performing Tests 1, 2, 3 on iOS when
               App Transport Security isn't explicitly disabled (assuming use of iOS 9 or greater)). -->
        </subaactivity>
      </aactivity>
          </f-element>
	</change>

    </decision>
  </bunch>
</technical-decisions>
